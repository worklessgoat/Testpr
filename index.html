<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0d1117">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>USDTPORTAL | INSTITUTIONAL STAKING</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@300;400;500;700&display=swap" rel="stylesheet">

<style>
    /* * ==========================================================================
     * SYSTEM TOKENS - USDT THEME
     * ==========================================================================
     */
    :root {
        --bg-root: #0d1117;
        --bg-panel: #161b22;
        --bg-card: #21262d;
        
        --border-light: rgba(240, 246, 252, 0.1);
        --border-hover: rgba(240, 246, 252, 0.2);
        
        /* USDT Teal Colors */
        --col-usdt: #26a17b; 
        --col-usdt-dim: #1e7e60;
        --col-accent: #50AF95;
        
        --col-danger: #f85149;
        --col-warn: #e3b341;
        --col-text-main: #c9d1d9;
        --col-text-muted: #8b949e;
        --col-white: #ffffff;
        
        --font-ui: 'Inter', sans-serif;
        --font-data: 'JetBrains Mono', monospace;
        
        --ease-quart: cubic-bezier(0.165, 0.84, 0.44, 1);
        --header-h: 64px;
    }

    /* --- RESET & BASE --- */
    * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
    body, html { 
        margin: 0; padding: 0; width: 100%; height: 100%; 
        background: var(--bg-root); color: var(--col-text-main); 
        font-family: var(--font-ui); overflow: hidden; 
        user-select: none;
    }

    /* --- UTILITIES --- */
    .flex { display: flex; }
    .flex-col { flex-direction: column; }
    .items-center { align-items: center; }
    .justify-between { justify-content: space-between; }
    .gap-2 { gap: 8px; } .gap-4 { gap: 16px; }
    .text-mono { font-family: var(--font-data); }
    .text-sm { font-size: 0.85rem; }
    .text-xs { font-size: 0.75rem; }
    .text-green { color: var(--col-usdt); }
    .text-red { color: var(--col-danger); }
    .text-white { color: var(--col-white); }
    .text-muted { color: var(--col-text-muted); }
    .uppercase { text-transform: uppercase; }
    .hidden { display: none !important; opacity: 0; pointer-events: none; }
    .full-width { width: 100%; }
    
    /* --- SVGs --- */
    .icon { width: 18px; height: 18px; fill: none; stroke: currentColor; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
    .icon-sm { width: 14px; height: 14px; }

    /* --- COMPONENTS --- */
    .btn {
        background: rgba(255,255,255,0.03); border: 1px solid var(--border-light); color: var(--col-white);
        padding: 10px 16px; border-radius: 6px; font-family: var(--font-ui); font-size: 0.8rem; font-weight: 600;
        cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; justify-content: center; gap: 8px; letter-spacing: 0.3px;
        white-space: nowrap; touch-action: manipulation;
    }
    .btn:active { transform: translateY(1px); }
    
    .btn-primary {
        background: var(--col-usdt); color: #fff; border: 1px solid var(--col-usdt-dim);
        text-shadow: 0 1px 2px rgba(0,0,0,0.2);
    }
    .btn-primary:hover { background: var(--col-accent); box-shadow: 0 0 15px rgba(38, 161, 123, 0.4); }

    .input-group { position: relative; width: 100%; margin-bottom: 18px; }
    .input-std {
        width: 100%; background: #010409; border: 1px solid var(--border-light); color: #fff;
        padding: 16px; border-radius: 6px; font-family: var(--font-data); font-size: 0.95rem; transition: 0.3s;
        appearance: none; -webkit-appearance: none;
    }
    .input-std:focus { border-color: var(--col-usdt); box-shadow: 0 0 0 2px rgba(38, 161, 123, 0.1); }
    .input-label { position: absolute; top: -9px; left: 12px; background: var(--bg-card); padding: 0 6px; font-size: 0.7rem; color: var(--col-text-muted); border-radius: 4px; }

    .badge {
        padding: 2px 8px; border-radius: 10px; font-family: var(--font-data); font-size: 0.65rem; letter-spacing: 0.5px; font-weight: 600;
        background: rgba(255,255,255,0.05); border: 1px solid var(--border-light);
    }
    .badge-live { background: rgba(38, 161, 123, 0.15); color: var(--col-usdt); border-color: rgba(38, 161, 123, 0.3); display: flex; align-items: center; gap: 6px; }
    .pulse-dot { width: 6px; height: 6px; background: currentColor; border-radius: 50%; animation: pulse 1.5s infinite; box-shadow: 0 0 5px currentColor; }

    /* --- ANIMATIONS --- */
    @keyframes pulse { 0% { opacity: 0.4; } 50% { opacity: 1; } 100% { opacity: 0.4; } }
    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes slideIn { from { opacity: 0; transform: translateY(15px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }
    @keyframes shake { 0%, 100% { transform: translateX(0); } 10%, 30%, 50%, 70%, 90% { transform: translateX(-4px); } 20%, 40%, 60%, 80% { transform: translateX(4px); } }

    /* --- BACKGROUND FX --- */
    #bg-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.4; pointer-events: none; }
    .grid-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0;
        background-image: 
            linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
            linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
        background-size: 40px 40px;
        mask-image: radial-gradient(circle at center, black 40%, transparent 100%);
        -webkit-mask-image: radial-gradient(circle at center, black 40%, transparent 100%);
    }

    /* --- LAYOUT STRUCTURE --- */
    .app-container {
        display: grid; 
        grid-template-rows: var(--header-h) 1fr; 
        height: 100vh;
        width: 100vw;
        opacity: 0;
        transition: opacity 1s var(--ease-quart);
        overflow: hidden;
    }

    /* Header */
    .header {
        background: rgba(22, 27, 34, 0.8); border-bottom: 1px solid var(--border-light);
        display: flex; align-items: center; justify-content: space-between; 
        padding: 0 24px;
        z-index: 50; backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
        width: 100%;
    }
    .logo-area { display: flex; align-items: center; gap: 12px; font-weight: 700; letter-spacing: -0.3px; font-size: 1.1rem; color: #fff; white-space: nowrap; }
    .logo-icon { width: 32px; height: 32px; background: var(--col-usdt); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 18px; }
    
    .nav-items { display: flex; gap: 24px; margin-left: 40px; }
    .nav-link { font-size: 0.9rem; color: var(--col-text-muted); cursor: pointer; transition: 0.2s; font-weight: 500; }
    .nav-link:hover, .nav-link.active { color: #fff; }

    /* Body Grid */
    .workspace {
        display: grid;
        grid-template-columns: 280px 1fr 320px;
        overflow: hidden;
        position: relative;
        width: 100%;
    }

    /* Sidebars */
    .sidebar {
        background: var(--bg-panel); border-right: 1px solid var(--border-light);
        display: flex; flex-direction: column; overflow-y: auto;
    }
    .sidebar-right {
        background: var(--bg-panel); border-left: 1px solid var(--border-light);
        display: flex; flex-direction: column; overflow-y: auto;
    }
    
    .panel-header {
        padding: 16px 20px; border-bottom: 1px solid var(--border-light);
        font-family: var(--font-data); font-size: 0.7rem; color: var(--col-text-muted); font-weight: 700;
        display: flex; justify-content: space-between; align-items: center; letter-spacing: 0.5px;
    }

    /* Main Center */
    .main-view {
        background: transparent; overflow-y: auto; padding: 24px;
        display: flex; flex-direction: column; gap: 24px;
        width: 100%;
        -webkit-overflow-scrolling: touch; /* Smooth scroll mobile */
    }

    /* --- WIDGETS --- */
    .card {
        background: var(--bg-card); border: 1px solid var(--border-light); border-radius: 12px;
        overflow: hidden; position: relative; width: 100%; box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    }

    /* Balance Hero */
    .hero-section {
        display: flex; justify-content: space-between; align-items: flex-end; padding: 30px;
        background: linear-gradient(180deg, rgba(38, 161, 123, 0.08) 0%, rgba(33, 38, 45, 0) 100%);
    }
    .bal-label { font-size: 0.85rem; color: var(--col-text-muted); margin-bottom: 8px; font-weight: 500; display: flex; align-items: center; gap: 8px; }
    /* Clamp: Dynamic font size between 2rem and 3.5rem depending on screen width */
    .bal-val { 
        font-family: var(--font-data); 
        font-size: clamp(2rem, 5vw, 3.5rem); 
        font-weight: 700; line-height: 1; 
        letter-spacing: -1px; margin: 5px 0 15px 0; color: #fff; 
        white-space: nowrap;
    }
    .bal-pnl { display: flex; align-items: center; gap: 8px; color: var(--col-usdt); font-family: var(--font-data); font-size: 0.95rem; background: rgba(38, 161, 123, 0.1); padding: 4px 8px; border-radius: 4px; width: fit-content; }
    
    /* Chart */
    .chart-container { height: 380px; width: 100%; position: relative; background: #1a1f26; }
    
    /* List Items */
    .list-item {
        display: flex; justify-content: space-between; align-items: center;
        padding: 14px 20px; border-bottom: 1px solid var(--border-light);
        font-size: 0.85rem; transition: 0.2s; cursor: default;
    }
    .list-item:hover { background: rgba(255,255,255,0.02); }
    .list-item:last-child { border-bottom: none; }

    /* --- MODALS --- */
    .modal-overlay {
        position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 1000;
        display: flex; align-items: center; justify-content: center; backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
        padding: 20px; transition: 0.3s;
    }
    .modal {
        background: #161b22; border: 1px solid var(--border-light); 
        width: 100%; max-width: 460px;
        border-radius: 16px; overflow: hidden; box-shadow: 0 50px 100px -20px rgba(0,0,0,0.8);
        animation: slideIn 0.4s var(--ease-quart); transform-origin: bottom center;
        max-height: 90vh; display: flex; flex-direction: column; /* Ensure mobile fit */
    }
    .modal-body { padding: 32px; overflow-y: auto; }
    .modal-footer { padding: 20px 32px; background: #0d1117; border-top: 1px solid var(--border-light); display: flex; gap: 12px; }

    /* Login Specific */
    .shake-anim { animation: shake 0.4s ease-in-out; }
    .login-logo { width: 64px; height: 64px; background: var(--col-usdt); border-radius: 50%; margin: 0 auto 20px auto; display: flex; align-items: center; justify-content: center; font-size: 32px; font-weight: bold; color: white; box-shadow: 0 0 30px rgba(38, 161, 123, 0.3); }

    /* Loader specific */
    .loader-ring {
        width: 60px; height: 60px; border: 4px solid rgba(255,255,255,0.05); border-top: 4px solid var(--col-usdt);
        border-radius: 50%; animation: spin 0.8s linear infinite; margin: 0 auto 25px auto;
    }
    .step-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-family: var(--font-data); font-size: 0.8rem; color: #666; transition: 0.3s; }
    .step-row.active { color: #fff; background: rgba(255,255,255,0.02); padding-left: 10px; padding-right: 10px; border-radius: 4px; border-bottom: none; }
    .step-row.done span:last-child { color: var(--col-usdt); }

    /* --- MOBILE RESPONSIVE --- */
    @media (max-width: 1100px) {
        .workspace { grid-template-columns: 240px 1fr; }
        .sidebar-right { display: none; }
        .hidden-mobile { display: none !important; }
    }

    @media (max-width: 768px) {
        .workspace { grid-template-columns: 1fr; }
        .sidebar { display: none; }
        .header { padding: 0 16px; height: 60px; }
        .nav-items { display: none; }
        .logo-area span { display: block; }
        .main-view { padding: 16px; gap: 16px; }
        .hero-section { flex-direction: column; align-items: flex-start; padding: 24px; }
        /* Hero text adjustments for mobile */
        .hero-section .text-right { display: none; }
        .modal-body { padding: 24px; }
        .modal-footer { padding: 16px 24px; }
        .chart-container { height: 260px; } /* Shorter chart on mobile */
        /* Adjust modal position for soft keyboard */
        .modal { margin-bottom: 10vh; }
    }
</style>


</head>
<body>

<canvas id="bg-canvas"></canvas>
<div class="grid-overlay"></div>

<div id="view-login" class="modal-overlay">
    <div class="modal" id="login-modal-box" style="border-top: 3px solid var(--col-usdt);">
        <div class="modal-body" style="text-align: center;">
            <div class="login-logo">T</div>
            <h2 style="font-family: var(--font-ui); margin: 0 0 8px 0; font-weight: 700; color: #fff;">USDTPORTAL</h2>
            <p style="color: var(--col-text-muted); font-size: 0.9rem; margin-bottom: 32px; font-weight: 300;">Institutional Staking Access</p>
            
            <div class="input-group">
                <span class="input-label">USER ID</span>
                <input type="text" id="inp-id" class="input-std" placeholder="Enter ID" autocapitalize="none">
            </div>
            <div class="input-group">
                <span class="input-label">PASSWORD</span>
                <input type="password" id="inp-key" class="input-std" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            </div>
            
            <div id="login-err" style="height: 20px; color: var(--col-danger); font-size: 0.8rem; font-family: var(--font-data); margin-bottom: 16px; font-weight: 600;"></div>
            
            <button class="btn btn-primary" style="width: 100%; justify-content: center; height: 50px; font-size: 0.9rem;" onclick="Engine.login()">
                SECURE LOGIN
            </button>
        </div>
        <div style="background: #0d1117; padding: 12px; font-size: 0.7rem; color: #444; text-align: center; font-family: var(--font-data); border-top: 1px solid var(--border-light);">
            ENCRYPTED VIA TETHER (TRC20) PROTOCOL
        </div>
    </div>
</div>

<div id="view-withdraw" class="modal-overlay hidden">
    <div class="modal">
        <div class="panel-header">
            <span>REQUEST PAYOUT</span>
            <span style="cursor: pointer;" onclick="Engine.toggle('view-withdraw', false)">âœ•</span>
        </div>
        <div class="modal-body">
            <div style="background: rgba(255,255,255,0.03); padding: 16px; border-radius: 8px; margin-bottom: 24px; display: flex; justify-content: space-between; border: 1px solid var(--border-light);">
                <span class="text-sm text-muted">Staked Balance</span>
                <span class="text-mono text-green" id="modal-bal">0.00 USDT</span>
            </div>
            <div class="input-group">
                <span class="input-label">TRC20 ADDRESS</span>
                <input type="text" class="input-std" placeholder="T..." style="font-family: var(--font-data);">
            </div>
            <div class="input-group">
                <span class="input-label">AMOUNT (USDT)</span>
                <input type="number" class="input-std" placeholder="0.00">
            </div>
            <div class="text-xs text-muted" style="line-height: 1.5;">
                *Withdrawals are processed via the TRON network. Ensure your receiving address supports TRC20 tokens.
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" onclick="Engine.toggle('view-withdraw', false)">CANCEL</button>
            <button class="btn btn-primary" style="flex: 1;" onclick="Engine.submitWithdraw()">INITIATE TRANSFER</button>
        </div>
    </div>
</div>

<div id="view-loading" class="modal-overlay hidden">
    <div class="modal" style="width: 420px; text-align: center;">
        <div class="modal-body">
            <div class="loader-ring"></div>
            <h3 style="margin: 0 0 24px 0; font-family: var(--font-ui); color: #fff;">PROCESSING REQUEST</h3>
            <div id="loading-steps">
                <div class="step-row" id="s1"><span>Validating TRC20 Address</span><span>WAITING</span></div>
                <div class="step-row" id="s2"><span>Calculating Gas (Energy/Bandwidth)</span><span>WAITING</span></div>
                <div class="step-row" id="s3"><span>Unstaking Principal Amount</span><span>WAITING</span></div>
                <div class="step-row" id="s4"><span>Finalizing Smart Contract</span><span>WAITING</span></div>
            </div>
        </div>
    </div>
</div>

<div id="view-error" class="modal-overlay hidden">
    <div class="modal" style="border-top: 4px solid var(--col-warn);">
        <div class="modal-body">
            <div style="margin-bottom: 15px; color: var(--col-warn); display: flex; align-items: center; gap: 10px;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                <span style="font-weight: 700; font-family: var(--font-data);">SMART CONTRACT NOTICE</span>
            </div>
            
            <h3 style="margin: 0 0 16px 0; color: white;">Funds Currently Locked</h3>
            
            <p style="font-size: 0.95rem; line-height: 1.6; color: #c9d1d9; margin-bottom: 24px;">
                This portfolio is currently in an active <strong>Institutional Staking Cycle</strong>. Early termination of the staking contract is not permitted under the current yield protocol.
            </p>

            <div style="background: rgba(227, 179, 65, 0.1); border: 1px solid rgba(227, 179, 65, 0.3); padding: 16px; border-radius: 8px; margin-bottom: 24px;">
                <div class="text-xs uppercase" style="color: var(--col-warn); margin-bottom: 8px; font-weight: 700; letter-spacing: 1px;">Unlocked Date</div>
                <div style="font-family: var(--font-data); font-size: 1.1rem; font-weight: 700; color: #fff;">
                    January 20, 2027
                </div>
                <div style="font-size: 0.8rem; color: #aaa; margin-top: 4px;">Protocol: 1 Year Fixed Yield Lock</div>
            </div>

            <p style="font-size: 0.8rem; color: var(--col-text-muted); line-height: 1.5;">
                Interest continues to compound daily. No action is required. Funds will be automatically released to your linked wallet upon contract maturity.
            </p>
        </div>
        <div class="modal-footer">
            <button class="btn full-width" onclick="Engine.toggle('view-error', false)">ACKNOWLEDGE</button>
        </div>
    </div>
</div>

<div id="main-app" class="app-container">
    
    <header class="header">
        <div class="logo-area">
            <div class="logo-icon">T</div>
            USDTPORTAL
        </div>
        
        <div class="nav-items">
            <div class="nav-link active">Dashboard</div>
            <div class="nav-link">Analytics</div>
            <div class="nav-link">Staking Pools</div>
            <div class="nav-link">Governance</div>
        </div>

        <div class="flex items-center gap-4">
            <div class="badge badge-live hidden-mobile"><div class="pulse-dot"></div> LIVE</div>
            <div class="text-mono text-xs text-muted hidden-mobile" id="clock">00:00:00 UTC</div>
            <button class="btn btn-primary" onclick="Engine.openWithdraw()">
                <svg class="icon icon-sm" viewBox="0 0 24 24"><path d="M21 12V7H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h16v7zm-3 2a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm3-2v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7h18z"/></svg>
                <span class="hidden-mobile">WITHDRAW</span> USDT
            </button>
        </div>
    </header>

    <div class="workspace">
        
        <aside class="sidebar">
            <div style="padding: 24px;">
                <div class="text-xs text-muted uppercase" style="margin-bottom: 12px; font-weight: 600;">Your Asset</div>
                <div class="card" style="padding: 20px; margin-bottom: 24px;">
                    <div class="flex items-center gap-2" style="margin-bottom: 8px;">
                        <div style="width: 20px; height: 20px; background: #26a17b; border-radius: 50%; display: grid; place-items: center; font-size: 10px; font-weight: bold; color: white;">T</div>
                        <span style="font-weight: 600;">Tether USDT</span>
                    </div>
                    <div class="text-mono text-white" style="font-size: 1.1rem; font-weight: 700;">$<span id="side-usd">12,671.00</span></div>
                    <div class="text-xs text-muted" style="margin-top: 8px; font-family: var(--font-data);">Network: TRC20</div>
                </div>

                <div class="text-xs text-muted uppercase" style="margin-bottom: 12px; font-weight: 600;">Markets</div>
                <div id="watchlist"></div>
            </div>
            
            <div style="margin-top: auto; padding: 24px; border-top: 1px solid var(--border-light);">
                <div class="text-xs text-muted">Client ID:</div>
                <div class="text-mono text-white" style="font-size: 0.8rem;">JussOG-8821</div>
            </div>
        </aside>

        <main class="main-view">
            
            <div class="card hero-section">
                <div>
                    <div class="bal-label">
                        TOTAL EQUITY
                        <span class="badge">APY 185%</span>
                    </div>
                    <div class="bal-val">$<span id="main-bal">12,671.00</span></div>
                    <div class="bal-pnl">
                        <svg class="icon icon-sm" viewBox="0 0 24 24"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>
                        <span id="main-pnl">0.00</span> Today
                    </div>
                </div>
                <div class="text-right hidden-mobile">
                    <div class="text-xs text-muted" style="margin-bottom: 6px;">Current Yield Rate</div>
                    <div class="text-mono text-green" style="font-size: 1.1rem; font-weight: 700;">$0.017 <span class="text-muted text-xs">/ min</span></div>
                </div>
            </div>

            <div class="card">
                <div class="panel-header">
                    <span>USDT STAKING PERFORMANCE</span>
                    <div class="flex gap-2">
                        <span class="badge">1H</span>
                        <span class="badge badge-live">LIVE</span>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="chart-canvas"></canvas>
                </div>
            </div>

            <div class="card">
                <div class="panel-header">TRANSACTION LEDGER</div>
                <div id="tx-log"></div>
            </div>

        </main>

        <aside class="sidebar-right">
            <div class="panel-header">NETWORK EVENTS</div>
            <div id="feed-container" style="flex: 1; padding: 12px;">
            </div>
        </aside>

    </div>
</div>

<script>
    /**
     * USDTPORTAL ENGINE
     * High-precision deterministic staking simulator.
     */
    
    const Engine = {
        // --- CONFIGURATION ---
        // GENESIS TIME: Fixed to January 30, 2026 
        // This ensures the balance is FRESH at 12,671 today.
        GENESIS_TIME: 1769731200000, 
        
        START_PRINCIPAL: 12671.00,
        currentBal: 0, 
        sessionProfit: 0.00,
        
        // Target: $3500 per week
        // $3500 / 7 days / 86400 sec = ~0.005787 USD/second
        GROWTH_RATE: 0.005787, 
        
        // State
        chartData: [],
        
        init() {
            // CALCULATE PERSISTENT BALANCE ON LOAD
            const now = Date.now();
            // Seconds elapsed since Genesis
            const elapsed = (now - this.GENESIS_TIME) / 1000;
            
            // Profit = Time * Rate
            // If elapsed is negative (system time error), we clamp it to 0
            const validElapsed = Math.max(0, elapsed);
            const timeProfit = validElapsed * this.GROWTH_RATE;
            
            // Add a deterministic sine wave based on the Day of the Year 
            // This ensures "volatility" is consistent if you refresh on the same day
            const noise = Math.sin(now / 86400000) * 5; 
            
            this.currentBal = this.START_PRINCIPAL + timeProfit + noise;
            
            this.initCanvas();
            this.renderWatchlist();
            this.startFeed();
            this.updateUI(); // FIX: Updates the balance immediately so it's correct before the screen is revealed.
            
            // Enter Key Listener
            document.getElementById('inp-key').addEventListener("keypress", (e) => {
                if (e.key === "Enter") Engine.login();
            });

            // Clock
            setInterval(() => {
                const now = new Date();
                const timeStr = now.toISOString().split('T')[1].split('.')[0] + " UTC";
                const el = document.getElementById('clock');
                if(el) el.innerText = timeStr;
            }, 1000);
            
            // Handle Resize
            window.addEventListener('resize', () => {
                this.renderChart();
            });
        },

        // --- AUTHENTICATION ---
        login() {
            const u = document.getElementById('inp-id').value;
            const p = document.getElementById('inp-key').value;
            const btn = document.querySelector('#view-login .btn-primary');
            const err = document.getElementById('login-err');
            const modalBox = document.getElementById('login-modal-box');

            if(u === "JussOG" && p === "Jussismyunc@089") {
                btn.innerHTML = `<div class="loader-ring" style="width:16px; height:16px; border-width:2px; margin:0;"></div> AUTHENTICATING...`;
                
                setTimeout(() => {
                    // Success
                    document.getElementById('view-login').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('view-login').style.display = 'none';
                        const app = document.getElementById('main-app');
                        app.style.opacity = '1';
                        this.startLiveEngine();
                    }, 800);
                }, 1000);
            } else {
                err.innerText = "INVALID CREDENTIALS";
                modalBox.classList.add('shake-anim');
                setTimeout(() => modalBox.classList.remove('shake-anim'), 400);
            }
        },

        // --- RUNTIME ---
        startLiveEngine() {
            // Pre-fill chart with history (Random Walk)
            this.genHistory();
            this.renderChart(); // FIX: Immediately render the chart so it is not empty.
            
            // Run Loop every 3 seconds for realistic volatility
            setInterval(() => {
                this.tick();
            }, 3000);

            // Update UI loop (faster for clock/feel)
            setInterval(() => {
               this.updateUI(); 
            }, 1000);
        },

        // --- CORE MATH & LOGIC ---
        tick() {
            // Determine volatility (Up or Down)
            // Bias: 60% Up, 40% Down to ensure long-term profit of ~0.005/sec
            
            const volatility = Math.random();
            let change = 0;
            let type = "";

            if (volatility > 0.35) {
                // WIN (Gain)
                change = (Math.random() * 0.050) + 0.0250;
                type = "YIELD";
            } else {
                // LOSS
                change = -((Math.random() * 0.030) + 0.0100);
                type = "GAS";
            }
            
            // Apply to Balance
            this.currentBal += change;
            this.sessionProfit += change;

            // Update Chart
            this.updateChart(this.currentBal);

            // Add to Ledger (Synced with ACTUAL movement)
            this.addLog(change, type);
        },

        updateUI() {
            const fmt = (n) => n.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            
            // Main Balance
            const mainBalEl = document.getElementById('main-bal');
            if(mainBalEl) mainBalEl.innerText = fmt(this.currentBal);
            
            const sideUsdEl = document.getElementById('side-usd');
            if(sideUsdEl) sideUsdEl.innerText = fmt(this.currentBal);
            
            // PNL (Today/Session)
            const pnl = document.getElementById('main-pnl');
            if(pnl) {
                pnl.innerText = (this.sessionProfit >= 0 ? "+" : "") + fmt(this.sessionProfit);
                pnl.style.color = this.sessionProfit >= 0 ? "var(--col-usdt)" : "var(--col-danger)";
            }

            // Modal
            const modalBal = document.getElementById('modal-bal');
            if(modalBal) modalBal.innerText = fmt(this.currentBal) + " USDT";
        },

        // --- WITHDRAWALS ---
        openWithdraw() {
            this.toggle('view-withdraw', true);
        },

        submitWithdraw() {
            this.toggle('view-withdraw', false);
            this.toggle('view-loading', true);
            
            const steps = [
                { id: 's1', time: 1500 },
                { id: 's2', time: 3500 },
                { id: 's3', time: 5500 },
                { id: 's4', time: 7500 }
            ];

            steps.forEach(step => {
                setTimeout(() => {
                    const el = document.getElementById(step.id);
                    if(step.id === 's4') {
                        el.classList.add('active');
                    } else {
                        el.classList.add('done');
                        el.querySelector('span:last-child').innerText = "CONFIRMED";
                    }
                }, step.time);
            });

            setTimeout(() => {
                this.toggle('view-loading', false);
                this.toggle('view-error', true);
                // Reset steps
                steps.forEach(s => {
                    const el = document.getElementById(s.id);
                    el.classList.remove('done', 'active');
                    el.querySelector('span:last-child').innerText = "WAITING";
                });
            }, 9000);
        },

        toggle(id, state) {
            const el = document.getElementById(id);
            if(state) el.classList.remove('hidden');
            else el.classList.add('hidden');
        },

        // --- UI HELPERS ---
        renderWatchlist() {
            const coins = [
                { s: 'USDT', p: '$1.00', c: '+0.01%', up: true },
                { s: 'BTC', p: '$102,420', c: '+1.4%', up: true },
                { s: 'ETH', p: '$3,892', c: '-0.2%', up: false },
                { s: 'TRX', p: '$0.18', c: '+2.1%', up: true }
            ];
            const con = document.getElementById('watchlist');
            if(!con) return;
            
            coins.forEach(c => {
                con.innerHTML += `
                <div class="list-item">
                    <div style="font-weight:600; color:#fff;">${c.s}</div>
                    <div style="text-align:right">
                        <div>${c.p}</div>
                        <div class="${c.up ? 'text-green' : 'text-red'} text-xs">${c.c}</div>
                    </div>
                </div>`;
            });
        },

        startFeed() {
            const msgs = [
                { t: "Yield Payout: Pool A", i: "ðŸ’µ" },
                { t: "New Staker: 8,000 USDT", i: "ðŸš€" },
                { t: "Network Difficulty Stable", i: "âš™ï¸" },
                { t: "TRC20 Volume +12%", i: "ðŸ“Š" }
            ];
            const con = document.getElementById('feed-container');
            if(!con) return;

            setInterval(() => {
                const m = msgs[Math.floor(Math.random() * msgs.length)];
                const div = document.createElement('div');
                div.className = 'list-item';
                div.style.border = 'none';
                div.innerHTML = `
                    <div style="display:flex; gap:12px; align-items:center;">
                        <div style="font-size:1.2rem">${m.i}</div>
                        <div>
                            <div class="text-sm" style="color:#fff;">${m.t}</div>
                            <div class="text-xs text-muted">Just now</div>
                        </div>
                    </div>`;
                con.prepend(div);
                if(con.children.length > 7) con.lastChild.remove();
            }, 4000);
        },

        addLog(amount, type) {
            const con = document.getElementById('tx-log');
            if(!con) return;

            const isWin = amount > 0;
            const hash = Math.random().toString(36).substring(2,10).toUpperCase();
            
            const div = document.createElement('div');
            div.className = 'list-item';
            div.innerHTML = `
                <div class="flex gap-2 items-center">
                    <span class="badge" style="${isWin?'color:var(--col-usdt)':'color:var(--col-danger)'}">${type}</span>
                    <span class="text-mono text-xs text-muted">T${hash}</span>
                </div>
                <div class="text-mono ${isWin ? 'text-green' : 'text-red'}">
                    ${isWin ? '+' : ''}${amount.toFixed(4)} USDT
                </div>
            `;
            
            // Animation for new item
            div.style.opacity = '0';
            div.style.transform = 'translateY(-10px)';
            div.style.transition = '0.3s';
            
            con.prepend(div);
            
            // Trigger anim
            setTimeout(() => {
                div.style.opacity = '1';
                div.style.transform = 'translateY(0)';
            }, 50);

            if(con.children.length > 8) con.lastChild.remove();
        },

        // --- CANVAS & CHARTS ---
        genHistory() {
            // Generate REALISTIC random walk history
            // Start from CURRENT CALCULATED BALANCE and walk BACKWARDS
            
            let simBal = this.currentBal; // START FROM THE TIME-BASED BALANCE
            let tempArr = [];
            
            for(let i=0; i<60; i++) {
                tempArr.push(simBal);
                
                // Inverse logic of the Tick function to walk backwards
                const volatility = Math.random();
                let change = 0;
                
                if (volatility > 0.40) { // Slight bias in history too
                    change = (Math.random() * 0.050) + 0.0250; 
                    simBal -= change; // Subtract because we go back in time
                } else {
                    change = -((Math.random() * 0.030) + 0.0100); 
                    simBal -= change; // Add (double negative) because we go back
                }
            }
            // Reverse so index 0 is old, index 60 is now
            this.chartData = tempArr.reverse();
        },

        updateChart(val) {
            this.chartData.push(val);
            if(this.chartData.length > 60) this.chartData.shift();
            this.renderChart();
        },

        renderChart() {
            const cvs = document.getElementById('chart-canvas');
            if(!cvs) return;
            const ctx = cvs.getContext('2d');
            
            // Fix DPI
            const dpr = window.devicePixelRatio || 1;
            const rect = cvs.getBoundingClientRect();
            
            // Safety check for hidden elements
            if(rect.width === 0 || rect.height === 0) return;

            cvs.width = rect.width * dpr;
            cvs.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            
            const w = rect.width;
            const h = rect.height;
            
            const min = Math.min(...this.chartData);
            const max = Math.max(...this.chartData);
            const range = max - min || 0.0001;
            const padding = 20;

            ctx.clearRect(0,0,w,h);
            
            // Grid
            ctx.strokeStyle = "rgba(255,255,255,0.03)";
            ctx.lineWidth = 1;
            ctx.beginPath();
            for(let i=1; i<4; i++) {
                let y = (h/4)*i;
                ctx.moveTo(0, y); ctx.lineTo(w, y);
            }
            ctx.stroke();

            // Line
            ctx.beginPath();
            
            this.chartData.forEach((v, i) => {
                const x = (i / (this.chartData.length - 1)) * w;
                const normalized = (v - min) / range;
                const y = h - padding - (normalized * (h - padding*2));
                
                if(i===0) ctx.moveTo(x,y);
                else ctx.lineTo(x, y); // Straight lines for "jagged" realistic financial look
            });
            
            ctx.strokeStyle = "#26a17b";
            ctx.lineWidth = 2;
            ctx.lineJoin = 'round';
            ctx.shadowBlur = 10;
            ctx.shadowColor = "rgba(38, 161, 123, 0.5)";
            ctx.stroke();
            ctx.shadowBlur = 0;

            // Gradient Fill
            ctx.lineTo(w, h); ctx.lineTo(0, h);
            const grad = ctx.createLinearGradient(0,0,0,h);
            grad.addColorStop(0, "rgba(38, 161, 123, 0.2)");
            grad.addColorStop(1, "rgba(38, 161, 123, 0)");
            ctx.fillStyle = grad;
            ctx.fill();
        },
        
        initCanvas() {
            const cvs = document.getElementById('bg-canvas');
            if(!cvs) return;
            const ctx = cvs.getContext('2d');
            
            const resize = () => { cvs.width = window.innerWidth; cvs.height = window.innerHeight; };
            window.addEventListener('resize', resize);
            resize();

            const parts = Array.from({length: 30}, () => ({
                x: Math.random() * cvs.width,
                y: Math.random() * cvs.height,
                vx: (Math.random() - 0.5) * 0.3,
                vy: (Math.random() - 0.5) * 0.3,
                s: Math.random() * 2
            }));

            const loop = () => {
                ctx.clearRect(0,0,cvs.width,cvs.height);
                ctx.fillStyle = "#26a17b";
                parts.forEach(p => {
                    p.x += p.vx; p.y += p.vy;
                    if(p.x < 0 || p.x > cvs.width) p.vx *= -1;
                    if(p.y < 0 || p.y > cvs.height) p.vy *= -1;
                    ctx.globalAlpha = 0.15;
                    ctx.beginPath(); ctx.arc(p.x, p.y, p.s, 0, Math.PI*2); ctx.fill();
                });
                requestAnimationFrame(loop);
            };
            loop();
        }
    };

    // Boot
    window.addEventListener('load', () => Engine.init());

</script>

</body>
</html>
